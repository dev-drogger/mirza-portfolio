<!DOCTYPE html>
<html>
  <head>
    <title>Public Drive API Access</title>
    <meta charset="utf-8" />
  </head>
  <body>
    <p>Public Drive API Access</p>
    <img
      src="https://drive.google.com/uc?export=view&id=1niU2R0gUaQDjN7PsFTDxRYlhVzVIhkX4"
      style="height: 100px; width: 100px; border: 5px; border-color: black"
      alt="img"
    />
    <pre id="content" style="white-space: pre-wrap"></pre>

    <script type="text/javascript">
      const API_KEY = "AIzaSyDjsk-wTBDsAlFQ0aCOMTqHyGN5ZZoFhAA"; // Replace with your API key
      const FOLDER_ID = "1IUXphdovW6T8x4AoLeUt4CgIdQnKZhpE"; // Replace with the public folder ID

      async function listFilesInFolder(folderId) {
        let response;
        try {
          // Fetch the subfolders in the specified folder
          response = await fetch(
            `https://www.googleapis.com/drive/v3/files?q='${folderId}' in parents and mimeType='application/vnd.google-apps.folder'&key=${API_KEY}&fields=files(id,name,webViewLink)`
          );
          const folderData = await response.json();

          // Prepare an array to hold the folder details
          const foldersWithFiles = await Promise.all(
            folderData.files.map(async (folder) => {
              // Fetch the files within each subfolder
              const filesResponse = await fetch(
                `https://www.googleapis.com/drive/v3/files?q='${folder.id}' in parents&key=${API_KEY}&fields=files(id,name,webContentLink)`
              );
              const filesData = await filesResponse.json();

              // Return the folder object including its files
              return {
                id: folder.id,
                name: folder.name,
                path: folder.webViewLink,
                metadata: filesData.files.map((file) => ({
                  id: file.id,
                  name: file.name,
                  path: file.webContentLink, // Changed from webViewLink to path
                })),
              };
            })
          );
          console.log(foldersWithFiles);
          return foldersWithFiles;
        } catch (err) {
          document.getElementById("content").innerText = err.message;
          return [];
        }
      }

      async function displayFiles() {
        const files = await listFilesInFolder(FOLDER_ID);
        if (!files.length) {
          document.getElementById("content").innerText = "No files found.";
          return;
        }

        let output = "Files:\n";
        for (const file of files) {
          output += `id: (${file.id}), name: ${file.name}, path: ${file.webViewLink}\n`;
        }
        document.getElementById("content").innerText = output;
      }

      // Call the displayFiles function when the page loads
      displayFiles();
    </script>
  </body>
</html>
